<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cercanos | Patient Outcomes Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap');

        :root {
            --orange: #de8130;
            --tan: #a47864;
            --deep-purple: #2d1628;
            --blush: #e6d9d3;
            --brown: #5a4b44;
            --olive-green: #777b41;
            --gold: #f3bf57;
            --navy-blue: #2f6089;
            --purple: #652875;
            --bg-light: #faf8f6;
            --card-bg: #ffffff;
            --text-primary: #2d1628;
            --text-secondary: #5a4b44;
            --border-color: #e6d9d3;
            --pro-color: #2f6089;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--deep-purple) 0%, #3d2638 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(45, 22, 40, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-heart {
            height: 36px;
            width: auto;
        }

        .logo-wordmark {
            height: 28px;
            width: auto;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a8b060;
            letter-spacing: 1px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .view-toggle {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-toggle button {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.7);
            font-family: inherit;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: var(--orange);
            color: white;
        }

        .user-info {
            color: white;
            font-size: 0.875rem;
        }

        .user-info span { opacity: 0.7; }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Enrollment Banner */
        .enrollment-banner {
            background: linear-gradient(90deg, var(--gold) 0%, #e6a832 100%);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(243, 191, 87, 0.3);
        }

        .enrollment-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .enrollment-icon { font-size: 1.5rem; }

        .enrollment-text { color: var(--deep-purple); }
        .enrollment-text strong { font-size: 1.1rem; }
        .enrollment-text p { font-size: 0.8rem; opacity: 0.8; }

        .enrollment-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-track {
            width: 200px;
            height: 8px;
            background: rgba(45, 22, 40, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill-enrollment {
            height: 100%;
            background: var(--deep-purple);
            border-radius: 4px;
        }

        .days-remaining {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--deep-purple);
        }

        .days-label {
            font-size: 0.7rem;
            color: var(--deep-purple);
            opacity: 0.7;
        }

        .reengage-btn {
            background: var(--deep-purple);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
        }

        .reengage-btn:hover {
            background: #3d2638;
        }

        /* Patient Header */
        .patient-header {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 12px rgba(45, 22, 40, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--orange);
        }

        .patient-info h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--deep-purple);
            margin-bottom: 0.25rem;
        }

        .patient-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .patient-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-item.clickable {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .stat-item.clickable:hover {
            background: var(--blush);
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--olive-green);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-item.clickable .stat-label::after {
            content: ' ‚ñ∏';
            color: var(--orange);
        }

        /* Dashboard Grid - Adjusted for bigger wheel */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 1.5rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--deep-purple);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--orange);
            border-radius: 2px;
        }

        /* Wheel Section - Bigger */
        .wheel-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(45, 22, 40, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-section .section-title {
            align-self: flex-start;
        }

        .wheel-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            aspect-ratio: 1;
            margin: 0 auto;
        }

        .wheel-canvas {
            width: 100%;
            height: 100%;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            width: 100%;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }

        /* Details Section */
        .details-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .detail-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(45, 22, 40, 0.06);
        }

        /* PRO-specific styling */
        .detail-card.pro-active {
            background: linear-gradient(135deg, rgba(47, 96, 137, 0.08) 0%, rgba(47, 96, 137, 0.03) 100%);
            border: 1px solid rgba(47, 96, 137, 0.2);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .metric-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--deep-purple);
        }

        .metric-category {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .status-excellent { background: rgba(119, 123, 65, 0.15); color: #777b41; }
        .status-good { background: rgba(47, 96, 137, 0.15); color: #2f6089; }
        .status-caution { background: rgba(243, 191, 87, 0.2); color: #b8860b; }
        .status-attention { background: rgba(222, 129, 48, 0.15); color: #de8130; }

        .metric-content {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .metric-value-large {
            font-size: 2rem;
            font-weight: 700;
            color: var(--deep-purple);
        }

        .metric-details { flex: 1; }

        .metric-target {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 6px;
            background: var(--blush);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }

        .info-btn {
            background: var(--blush);
            border: 1px solid var(--border-color);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .info-btn:hover {
            background: var(--orange);
            color: white;
            border-color: var(--orange);
        }

        /* Exam Info */
        .exam-info {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .exam-item {
            flex: 1;
            background: var(--blush);
            border-radius: 8px;
            padding: 0.6rem;
            text-align: center;
        }

        .exam-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.2rem;
        }

        .exam-date {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--deep-purple);
        }

        .exam-result {
            font-size: 0.7rem;
            color: var(--olive-green);
        }

        /* PRO Summary + Accordion */
        .pro-summary {
            background: rgba(47, 96, 137, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .pro-summary-score {
            text-align: center;
            padding-right: 1rem;
            border-right: 2px solid rgba(47, 96, 137, 0.2);
        }

        .pro-summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--navy-blue);
        }

        .pro-summary-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .pro-summary-text {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .pro-accordion {
            border: 1px solid rgba(47, 96, 137, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .pro-accordion-item {
            border-bottom: 1px solid rgba(47, 96, 137, 0.15);
        }

        .pro-accordion-item:last-child {
            border-bottom: none;
        }

        .pro-accordion-header {
            background: rgba(47, 96, 137, 0.05);
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .pro-accordion-header:hover {
            background: rgba(47, 96, 137, 0.1);
        }

        .pro-accordion-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .pro-accordion-title .measure-name {
            font-weight: 600;
            color: var(--deep-purple);
            font-size: 0.9rem;
        }

        .pro-accordion-title .measure-tool {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .pro-accordion-score {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .pro-score-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--navy-blue);
        }

        .pro-score-status {
            font-size: 0.65rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
        }

        .pro-score-status.good { background: rgba(119, 123, 65, 0.2); color: #777b41; }
        .pro-score-status.moderate { background: rgba(243, 191, 87, 0.2); color: #b8860b; }
        .pro-score-status.concern { background: rgba(222, 129, 48, 0.2); color: #de8130; }

        .pro-accordion-toggle {
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
        }

        .pro-accordion-item.open .pro-accordion-toggle {
            transform: rotate(180deg);
        }

        .pro-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }

        .pro-accordion-item.open .pro-accordion-content {
            max-height: 200px;
        }

        .pro-accordion-body {
            padding: 1rem;
        }

        .pro-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            font-size: 0.8rem;
            border-bottom: 1px dashed var(--border-color);
        }

        .pro-detail-row:last-child {
            border-bottom: none;
        }

        .pro-detail-label {
            color: var(--text-secondary);
        }

        .pro-detail-value {
            font-weight: 600;
            color: var(--deep-purple);
        }

        .pro-interpretation {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(47, 96, 137, 0.05);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--navy-blue);
        }

        /* Metabolic Grid */
        .metabolic-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .metabolic-panel {
            background: var(--blush);
            border-radius: 10px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .metabolic-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 22, 40, 0.1);
        }

        .metabolic-panel.active {
            border-color: var(--orange);
            background: white;
        }

        .metabolic-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.4rem;
        }

        .metabolic-label {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .metabolic-status {
            font-size: 0.55rem;
            padding: 0.1rem 0.35rem;
            border-radius: 4px;
        }

        .metabolic-status.on-target { background: rgba(119, 123, 65, 0.2); color: #777b41; }
        .metabolic-status.improving { background: rgba(47, 96, 137, 0.2); color: #2f6089; }
        .metabolic-status.caution { background: rgba(243, 191, 87, 0.2); color: #b8860b; }

        .metabolic-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--deep-purple);
        }

        .metabolic-target {
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        .metabolic-sparkline {
            height: 25px;
            margin-top: 0.4rem;
        }

        /* Category Cards */
        .category-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .category-card {
            background: var(--blush);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 22, 40, 0.1);
        }

        .category-card.active {
            border-color: var(--orange);
            background: white;
        }

        .category-card.pro-card.active {
            border-color: var(--navy-blue);
            background: rgba(47, 96, 137, 0.08);
        }

        .category-icon {
            width: 24px;
            height: 24px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.25rem;
            font-size: 0.8rem;
        }

        .category-name {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--deep-purple);
            line-height: 1.2;
        }

        .category-score {
            font-size: 0.55rem;
            color: var(--text-secondary);
            margin-top: 0.1rem;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 22, 40, 0.5);
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(45, 22, 40, 0.3);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background: var(--deep-purple);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1rem; }

        .modal-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .modal-body { padding: 1.5rem; }

        /* Glucose Table */
        .glucose-table {
            width: 100%;
            border-collapse: collapse;
        }

        .glucose-table th {
            text-align: left;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            padding: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .glucose-table td {
            padding: 0.6rem 0.5rem;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--border-color);
        }

        .glucose-value { font-weight: 700; }
        .glucose-value.low { color: var(--orange); }
        .glucose-value.normal { color: var(--olive-green); }
        .glucose-value.high { color: #d63031; }

        .glucose-source {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Care Team Modal */
        .care-team-group { margin-bottom: 1.25rem; }
        .care-team-group:last-child { margin-bottom: 0; }

        .care-team-role {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .care-team-role .count {
            background: var(--orange);
            color: white;
            font-size: 0.65rem;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
        }

        .care-team-member {
            background: var(--blush);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .member-name {
            font-weight: 600;
            color: var(--deep-purple);
            font-size: 0.9rem;
        }

        .member-last-visit {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Sidebars */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 22, 40, 0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -480px;
            width: 480px;
            height: 100vh;
            background: var(--bg-light);
            z-index: 201;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -4px 0 20px rgba(45, 22, 40, 0.2);
        }

        .sidebar.open {
            right: 0;
        }

        .sidebar-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sidebar-header.util { background: var(--navy-blue); color: white; }
        .sidebar-header.sdoh { background: var(--purple); color: white; }

        .sidebar-header h3 { font-size: 1rem; }

        .sidebar-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.25rem;
        }

        .sidebar-content { padding: 1.5rem; }

        /* Utilization Summary */
        .util-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .util-summary-card {
            background: white;
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
            box-shadow: 0 1px 4px rgba(45, 22, 40, 0.05);
        }

        .util-summary-icon { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .util-summary-value { font-size: 1.25rem; font-weight: 700; color: var(--deep-purple); }
        .util-summary-label { font-size: 0.65rem; color: var(--text-secondary); }

        /* Utilization Timeline */
        .util-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .util-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .util-event {
            position: relative;
            margin-bottom: 1rem;
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 1px 4px rgba(45, 22, 40, 0.05);
        }

        .util-event::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 1rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }

        .util-event.er::before { background: #ff6b6b; box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.2); }
        .util-event.hospital::before { background: var(--orange); box-shadow: 0 0 0 4px rgba(222, 129, 48, 0.2); }
        .util-event.specialist::before { background: var(--navy-blue); box-shadow: 0 0 0 4px rgba(47, 96, 137, 0.2); }

        .util-event-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .util-event-type {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
        }

        .util-event.er .util-event-type { background: rgba(255, 107, 107, 0.15); color: #d63031; }
        .util-event.hospital .util-event-type { background: rgba(222, 129, 48, 0.15); color: var(--orange); }
        .util-event.specialist .util-event-type { background: rgba(47, 96, 137, 0.15); color: var(--navy-blue); }

        .util-event-date { font-size: 0.75rem; color: var(--text-secondary); }
        .util-event-title { font-weight: 600; color: var(--deep-purple); font-size: 0.9rem; margin-bottom: 0.25rem; }
        .util-event-details { font-size: 0.8rem; color: var(--text-secondary); }

        /* SDOH Sidebar Styles */
        .sdoh-section {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 4px rgba(45, 22, 40, 0.05);
        }

        .sdoh-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--purple);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sdoh-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .sdoh-row:last-child { border-bottom: none; }

        .sdoh-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .sdoh-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--deep-purple);
        }

        .sdoh-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .sdoh-badge.risk-high { background: rgba(222, 129, 48, 0.2); color: var(--orange); }
        .sdoh-badge.risk-medium { background: rgba(243, 191, 87, 0.2); color: #b8860b; }
        .sdoh-badge.risk-low { background: rgba(119, 123, 65, 0.2); color: var(--olive-green); }
        .sdoh-badge.status-concern { background: rgba(222, 129, 48, 0.15); color: var(--orange); }
        .sdoh-badge.status-ok { background: rgba(119, 123, 65, 0.15); color: var(--olive-green); }

        .sdoh-note {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: rgba(101, 40, 117, 0.08);
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--purple);
        }

        /* PCP View Styles */
        .patient-view { display: block; }
        .practice-view { display: none; }
        .patient-list-view { display: none; }

        .pcp-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .pcp-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .pcp-tab:hover { color: var(--deep-purple); }
        .pcp-tab.active { color: var(--orange); border-bottom-color: var(--orange); }

        .pcp-tab-content { display: none; }
        .pcp-tab-content.active { display: block; }

        .practice-snapshot {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .snapshot-tile {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(45, 22, 40, 0.05);
            border-top: 3px solid var(--olive-green);
        }

        .snapshot-tile.highlight { border-top-color: var(--orange); }
        .snapshot-tile.caution { border-top-color: var(--gold); }

        .snapshot-value { font-size: 1.75rem; font-weight: 700; color: var(--deep-purple); }
        .snapshot-label { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; margin-top: 0.25rem; }
        .snapshot-delta { font-size: 0.7rem; margin-top: 0.25rem; }
        .snapshot-delta.positive { color: var(--olive-green); }

        .pcp-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(45, 22, 40, 0.06);
        }

        .secondary-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .secondary-metric {
            background: var(--blush);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .secondary-metric-label { font-size: 0.8rem; color: var(--text-secondary); }
        .secondary-metric-value { font-size: 1rem; font-weight: 700; color: var(--deep-purple); }

        .population-section h4 {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin: 1rem 0 0.5rem;
        }

        .population-section h4:first-of-type { margin-top: 0; }

        .condition-row {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .condition-row:last-child { border-bottom: none; }

        .condition-name { width: 100px; font-size: 0.85rem; font-weight: 600; color: var(--deep-purple); }

        .condition-bar {
            flex: 1;
            height: 20px;
            background: var(--blush);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 0.75rem;
        }

        .condition-fill { height: 100%; border-radius: 4px; }

        .condition-stats { font-size: 0.75rem; color: var(--text-secondary); min-width: 100px; text-align: right; }

        .risk-tier {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
        }

        .risk-tier.high { background: rgba(222, 129, 48, 0.15); }
        .risk-tier.medium { background: rgba(243, 191, 87, 0.15); }
        .risk-tier.low { background: rgba(119, 123, 65, 0.15); }

        .risk-tier-label { font-size: 0.85rem; font-weight: 600; }
        .risk-tier.high .risk-tier-label { color: var(--orange); }
        .risk-tier.medium .risk-tier-label { color: #b8860b; }
        .risk-tier.low .risk-tier-label { color: var(--olive-green); }

        .risk-tier-count { font-size: 1.25rem; font-weight: 700; color: var(--deep-purple); }

        .trend-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .trend-row:last-child { border-bottom: none; }

        .trend-label { width: 100px; font-size: 0.8rem; color: var(--text-secondary); }
        .trend-sparkline { flex: 1; height: 30px; margin: 0 1rem; }
        .trend-current { font-size: 1rem; font-weight: 700; color: var(--deep-purple); min-width: 60px; text-align: right; }

        .activity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .activity-item {
            background: var(--blush);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .activity-count { font-size: 1.5rem; font-weight: 700; color: var(--deep-purple); min-width: 40px; }
        .activity-label { font-size: 0.75rem; color: var(--text-secondary); line-height: 1.3; }

        .activity-highlight {
            background: linear-gradient(135deg, var(--navy-blue), #3a7aa8);
            grid-column: span 2;
            color: white;
        }

        .activity-highlight .activity-count,
        .activity-highlight .activity-label { color: white; }

        .comm-panel {
            background: linear-gradient(135deg, var(--navy-blue), #3a7aa8);
            border-radius: 12px;
            padding: 1.25rem;
            color: white;
            margin-top: 1.5rem;
        }

        .comm-panel h3 {
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pending-badge {
            background: var(--gold);
            color: var(--deep-purple);
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .comm-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.8rem;
        }

        .comm-date {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }

        /* Patient Table */
        .patient-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .filter-group { display: flex; gap: 0.5rem; }

        .filter-btn {
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: var(--orange);
            color: var(--orange);
            background: rgba(222, 129, 48, 0.05);
        }

        .search-input {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.875rem;
            width: 250px;
        }

        .patient-table { width: 100%; border-collapse: collapse; }

        .patient-table th {
            text-align: left;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            padding: 0.75rem 0.5rem;
            border-bottom: 2px solid var(--border-color);
            cursor: pointer;
            white-space: nowrap;
        }

        .patient-table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--border-color);
        }

        .patient-table tbody tr {
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .patient-table tbody tr:hover { background: var(--blush); }

        .patient-name-cell { font-weight: 600; color: var(--deep-purple); }
        .patient-conditions { display: flex; gap: 0.25rem; flex-wrap: wrap; }

        .condition-tag {
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            background: var(--blush);
            color: var(--text-secondary);
        }

        .risk-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .risk-badge.high { background: rgba(222, 129, 48, 0.2); color: var(--orange); }
        .risk-badge.medium { background: rgba(243, 191, 87, 0.2); color: #b8860b; }
        .risk-badge.low { background: rgba(119, 123, 65, 0.2); color: var(--olive-green); }

        .trend-icon { font-size: 1rem; }
        .trend-icon.up { color: #d63031; }
        .trend-icon.down { color: var(--olive-green); }
        .trend-icon.stable { color: var(--text-secondary); }

        .phase-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            background: var(--blush);
        }

        .flag-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: rgba(222, 129, 48, 0.15);
            color: var(--orange);
            display: inline-block;
            margin: 0.1rem;
        }

        /* VBC */
        .vbc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .vbc-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(45, 22, 40, 0.05);
        }

        .vbc-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .vbc-value { font-size: 1.5rem; font-weight: 700; color: var(--deep-purple); }
        .vbc-label { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .vbc-detail { font-size: 0.7rem; color: var(--olive-green); margin-top: 0.5rem; }

        .footer {
            margin-top: 2rem;
            padding: 1rem 2rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            margin-bottom: 0.5rem;
        }

        .footer-logo img.footer-heart {
            height: 24px;
            width: auto;
        }

        .footer-logo img.footer-wordmark {
            height: 18px;
            width: auto;
        }

        .footer-tagline {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .practice-snapshot { grid-template-columns: repeat(3, 1fr); }
            .pcp-grid { grid-template-columns: 1fr 1fr; }
            .vbc-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; padding: 1rem; }
            .enrollment-banner { flex-direction: column; gap: 1rem; text-align: center; }
            .patient-header { flex-direction: column; gap: 1rem; text-align: center; }
            .practice-snapshot { grid-template-columns: repeat(2, 1fr); }
            .pcp-grid { grid-template-columns: 1fr; }
            .sidebar { width: 100%; right: -100%; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="heart_icon.png" alt="Cercanos Heart" class="logo-heart">
            <img src="Logo_Cercanos_Green.png" alt="cercanos" class="logo-wordmark">
        </div>
        <div class="header-right">
            <div class="practice-selector" id="practiceSelectorContainer" style="display: none;">
                <label style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-right: 0.5rem;">Practice:</label>
                <select class="practice-dropdown" id="practiceDropdown" onchange="changePractice()" style="background: white; border: none; padding: 0.4rem 0.75rem; border-radius: 6px; font-family: inherit; font-size: 0.85rem; color: var(--deep-purple); cursor: pointer;">
                    <option value="centro">Centro de Salud Familiar</option>
                    <option value="clinica">Cl√≠nica del Valle</option>
                    <option value="medicina">Medicina Integral San Antonio</option>
                </select>
            </div>
            <div class="view-toggle">
                <button id="patientListBtn" onclick="switchView('patientList')">Patient List</button>
                <button id="patientViewBtn" class="active" onclick="switchView('patient')">Patient View</button>
                <button id="practiceViewBtn" onclick="switchView('practice')">Practice View</button>
            </div>
            <div class="user-info">
                <span>Logged in as:</span> Dr. Mar√≠a Gonz√°lez
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- PATIENT VIEW -->
        <div class="patient-view" id="patientView">
            <!-- Enrollment Banner -->
            <div class="enrollment-banner">
                <div class="enrollment-info">
                    <span class="enrollment-icon">üìÖ</span>
                    <div class="enrollment-text">
                        <strong>Enrollment Window Approaching</strong>
                        <p>Patient can disenroll starting March 15, 2026</p>
                    </div>
                </div>
                <div class="enrollment-progress">
                    <div>
                        <div class="progress-track">
                            <div class="progress-fill-enrollment" style="width: 52%;"></div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div class="days-remaining">47</div>
                        <div class="days-label">days until window</div>
                    </div>
                    <button class="reengage-btn" onclick="openReengageSidebar()">Re-engage Patient</button>
                </div>
            </div>

            <!-- Patient Header -->
            <div class="patient-header">
                <div class="patient-info">
                    <h1>Roberto Hern√°ndez</h1>
                    <p>DOB: March 15, 1962 | MRN: 847291 | Enrolled: August 2025</p>
                </div>
                <div class="patient-stats">
                    <div class="stat-item">
                        <div class="stat-value">78%</div>
                        <div class="stat-label">Overall Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Months Enrolled</div>
                    </div>
                    <div class="stat-item clickable" onclick="openCareTeamModal()">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Visits Completed</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Left: Wheel (Bigger) -->
                <div class="wheel-section">
                    <h2 class="section-title">Cardiometabolic Outcomes Wheel</h2>
                    <div class="wheel-container">
                        <canvas id="wheelCanvas" class="wheel-canvas"></canvas>
                    </div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot" style="background: #2f6089;"></div><span>Patient-Reported</span></div>
                        <div class="legend-item"><div class="legend-dot" style="background: #777b41;"></div><span>Acute Events</span></div>
                        <div class="legend-item"><div class="legend-dot" style="background: #de8130;"></div><span>Chronic</span></div>
                        <div class="legend-item"><div class="legend-dot" style="background: #a47864;"></div><span>Survival/Financial</span></div>
                        <div class="legend-item"><div class="legend-dot" style="background: #e6d9d3;"></div><span>Health Services</span></div>
                        <div class="legend-item"><div class="legend-dot" style="background: #f3bf57;"></div><span>Metabolic Control</span></div>
                    </div>
                </div>

                <!-- Right: Details -->
                <div class="details-section">
                    <!-- Metabolic Control Grid -->
                    <div class="detail-card">
                        <h3 class="section-title">Metabolic Control</h3>
                        <div class="metabolic-grid">
                            <div class="metabolic-panel active" onclick="selectMetabolicPanel(this, 'a1c')">
                                <div class="metabolic-header">
                                    <span class="metabolic-label">A1c</span>
                                    <span class="metabolic-status improving">Improving</span>
                                </div>
                                <div class="metabolic-value">7.2%</div>
                                <div class="metabolic-target">Target: &lt;7.0%</div>
                                <svg class="metabolic-sparkline" viewBox="0 0 100 25">
                                    <path fill="none" stroke="#777b41" stroke-width="2" d="M5,20 L20,18 L40,16 L60,12 L80,10 L95,8" />
                                    <circle cx="95" cy="8" r="3" fill="#de8130" />
                                </svg>
                            </div>
                            <div class="metabolic-panel" onclick="selectMetabolicPanel(this, 'bp')">
                                <div class="metabolic-header">
                                    <span class="metabolic-label">Blood Pressure</span>
                                    <span class="metabolic-status caution">Caution</span>
                                </div>
                                <div class="metabolic-value">142/88</div>
                                <div class="metabolic-target">Target: &lt;140/90</div>
                                <svg class="metabolic-sparkline" viewBox="0 0 100 25">
                                    <path fill="none" stroke="#de8130" stroke-width="2" d="M5,15 L20,14 L40,15 L60,12 L80,11 L95,13" />
                                    <circle cx="95" cy="13" r="3" fill="#de8130" />
                                </svg>
                            </div>
                            <div class="metabolic-panel" onclick="selectMetabolicPanel(this, 'weight')">
                                <div class="metabolic-header">
                                    <span class="metabolic-label">Weight</span>
                                    <span class="metabolic-status improving">Improving</span>
                                </div>
                                <div class="metabolic-value">198 lbs</div>
                                <div class="metabolic-target">Target: 185 lbs</div>
                                <svg class="metabolic-sparkline" viewBox="0 0 100 25">
                                    <path fill="none" stroke="#2f6089" stroke-width="2" d="M5,6 L20,8 L40,10 L60,12 L80,15 L95,16" />
                                    <circle cx="95" cy="16" r="3" fill="#de8130" />
                                </svg>
                            </div>
                            <div class="metabolic-panel" onclick="selectMetabolicPanel(this, 'ldl')">
                                <div class="metabolic-header">
                                    <span class="metabolic-label">LDL Cholesterol</span>
                                    <span class="metabolic-status on-target">On Target</span>
                                </div>
                                <div class="metabolic-value">92 mg/dL</div>
                                <div class="metabolic-target">Target: &lt;100</div>
                                <svg class="metabolic-sparkline" viewBox="0 0 100 25">
                                    <path fill="none" stroke="#777b41" stroke-width="2" d="M5,8 L20,10 L40,12 L60,14 L80,16 L95,17" />
                                    <circle cx="95" cy="17" r="3" fill="#de8130" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Selected Metric Detail -->
                    <div class="detail-card" id="metricDetail">
                        <div class="metric-header">
                            <div>
                                <div class="metric-category" id="selectedCategory">ACUTE EVENTS</div>
                                <div class="metric-title" id="selectedMetric">Hypoglycemia Episodes</div>
                            </div>
                            <span class="status-badge status-good" id="statusBadge">Good</span>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value-large" id="metricValue">1 mild</div>
                            <div class="metric-details">
                                <div class="metric-target" id="metricTarget">Target: 0 severe | Last: 3 total (Oct 2025)</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressBar" style="width: 85%; background: linear-gradient(90deg, var(--gold), var(--olive-green));"></div>
                                </div>
                                <button class="info-btn" id="detailBtn" onclick="showMetricDetails()">üìä View Last 10 Glucose Readings</button>
                            </div>
                        </div>
                        <div class="exam-info" id="examInfo" style="display: none;">
                            <div class="exam-item" id="examItem1">
                                <div class="exam-label">Last Eye Exam</div>
                                <div class="exam-date">Dec 15, 2025</div>
                                <div class="exam-result">No retinopathy</div>
                            </div>
                            <div class="exam-item" id="examItem2">
                                <div class="exam-label">Last Kidney Test</div>
                                <div class="exam-date">Jan 8, 2026</div>
                                <div class="exam-result">eGFR: 72 mL/min</div>
                            </div>
                        </div>
                        <!-- PRO Content (hidden by default) -->
                        <div id="proContent" style="display: none;">
                            <div class="pro-summary">
                                <div class="pro-summary-score">
                                    <div class="pro-summary-value">68%</div>
                                    <div class="pro-summary-label">Overall PRO</div>
                                </div>
                                <div class="pro-summary-text">
                                    Patient-reported outcomes show moderate psychological well-being with improving diabetes distress. Depression screening is within normal range.
                                </div>
                            </div>
                            <div class="pro-accordion">
                                <div class="pro-accordion-item" onclick="toggleProAccordion(this)">
                                    <div class="pro-accordion-header">
                                        <div class="pro-accordion-title">
                                            <span class="measure-name">Psychological Well-being</span>
                                            <span class="measure-tool">(WHO-5)</span>
                                        </div>
                                        <div class="pro-accordion-score">
                                            <span class="pro-score-value">72/100</span>
                                            <span class="pro-score-status good">Good</span>
                                            <span class="pro-accordion-toggle">‚ñº</span>
                                        </div>
                                    </div>
                                    <div class="pro-accordion-content">
                                        <div class="pro-accordion-body">
                                            <div class="pro-detail-row"><span class="pro-detail-label">Last Assessment</span><span class="pro-detail-value">Jan 15, 2026</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Previous Score</span><span class="pro-detail-value">65/100 (Dec 2025)</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Change</span><span class="pro-detail-value" style="color: var(--olive-green);">+7 points ‚Üë</span></div>
                                            <div class="pro-interpretation">
                                                <strong>Interpretation:</strong> Score indicates adequate psychological well-being. Improvement noted since last assessment.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pro-accordion-item" onclick="toggleProAccordion(this)">
                                    <div class="pro-accordion-header">
                                        <div class="pro-accordion-title">
                                            <span class="measure-name">Diabetes Distress</span>
                                            <span class="measure-tool">(PAID)</span>
                                        </div>
                                        <div class="pro-accordion-score">
                                            <span class="pro-score-value">2.1/6</span>
                                            <span class="pro-score-status moderate">Moderate</span>
                                            <span class="pro-accordion-toggle">‚ñº</span>
                                        </div>
                                    </div>
                                    <div class="pro-accordion-content">
                                        <div class="pro-accordion-body">
                                            <div class="pro-detail-row"><span class="pro-detail-label">Last Assessment</span><span class="pro-detail-value">Jan 15, 2026</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Previous Score</span><span class="pro-detail-value">2.8/6 (Dec 2025)</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Change</span><span class="pro-detail-value" style="color: var(--olive-green);">-0.7 points ‚Üì</span></div>
                                            <div class="pro-interpretation">
                                                <strong>Interpretation:</strong> Moderate distress level. Score <2.0 is target. Patient showing improvement in diabetes-related emotional burden.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pro-accordion-item" onclick="toggleProAccordion(this)">
                                    <div class="pro-accordion-header">
                                        <div class="pro-accordion-title">
                                            <span class="measure-name">Depression</span>
                                            <span class="measure-tool">(PHQ-9)</span>
                                        </div>
                                        <div class="pro-accordion-score">
                                            <span class="pro-score-value">4/27</span>
                                            <span class="pro-score-status good">Minimal</span>
                                            <span class="pro-accordion-toggle">‚ñº</span>
                                        </div>
                                    </div>
                                    <div class="pro-accordion-content">
                                        <div class="pro-accordion-body">
                                            <div class="pro-detail-row"><span class="pro-detail-label">Last Assessment</span><span class="pro-detail-value">Jan 15, 2026</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Previous Score</span><span class="pro-detail-value">7/27 (Nov 2025)</span></div>
                                            <div class="pro-detail-row"><span class="pro-detail-label">Change</span><span class="pro-detail-value" style="color: var(--olive-green);">-3 points ‚Üì</span></div>
                                            <div class="pro-interpretation">
                                                <strong>Interpretation:</strong> Minimal depression (0-4). Below clinical threshold. No intervention required at this time.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Cards -->
                    <div class="detail-card">
                        <h3 class="section-title">Outcome Categories</h3>
                        <div class="category-cards">
                            <div class="category-card pro-card" data-category="pro" onclick="selectCategory(this, 'pro')">
                                <div class="category-icon" style="background: var(--navy-blue); color: white;">üí≠</div>
                                <div class="category-name">Patient-Reported</div>
                                <div class="category-score">68% overall</div>
                            </div>
                            <div class="category-card active" data-category="acute" onclick="selectCategory(this, 'acute')">
                                <div class="category-icon" style="background: var(--olive-green); color: white;">‚ö°</div>
                                <div class="category-name">Acute Events</div>
                                <div class="category-score">1 mild hypo</div>
                            </div>
                            <div class="category-card" data-category="chronic" onclick="selectCategory(this, 'chronic')">
                                <div class="category-icon" style="background: var(--orange); color: white;">üîÑ</div>
                                <div class="category-name">Chronic</div>
                                <div class="category-score">Stable</div>
                            </div>
                            <div class="category-card" data-category="survival" onclick="selectCategory(this, 'survival')">
                                <div class="category-icon" style="background: var(--tan); color: white;">‚ù§Ô∏è</div>
                                <div class="category-name">Survival</div>
                                <div class="category-score">Active</div>
                            </div>
                            <div class="category-card" data-category="utilization" onclick="selectCategory(this, 'utilization')">
                                <div class="category-icon" style="background: var(--blush); border: 1px solid var(--tan);">üè•</div>
                                <div class="category-name">Utilization</div>
                                <div class="category-score">1 ER visit</div>
                            </div>
                            <div class="category-card" data-category="barriers" onclick="selectCategory(this, 'barriers')">
                                <div class="category-icon" style="background: var(--purple); color: white;">üí∞</div>
                                <div class="category-name">Financial/SDOH</div>
                                <div class="category-score">Needs support</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PATIENT LIST VIEW -->
        <div class="patient-list-view" id="patientListView" style="display: none;">
            <!-- Alert Banners -->
            <div class="alert-banner-critical" id="alertER" style="background: linear-gradient(90deg, #e85d5d 0%, #c44d4d 100%); border-radius: 12px; padding: 0.75rem 1.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; color: white;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-size: 1.5rem;">üö®</span>
                    <div><strong>ER Visit Alert</strong><p style="font-size: 0.8rem; opacity: 0.9; margin: 0;">Maria Santos visited ER yesterday - chest pain, discharged stable</p></div>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="reengage-btn" onclick="goToPatient('Maria Santos')">View Patient</button>
                    <button class="reengage-btn" style="background: rgba(255,255,255,0.2);" onclick="dismissAlert('alertER')">Dismiss</button>
                </div>
            </div>
            <div class="enrollment-banner" id="alertGlucose">
                <div class="enrollment-info"><span class="enrollment-icon">üìâ</span><div class="enrollment-text"><strong>Low Blood Sugar Alert</strong><p>Carlos Mendoza reported glucose of 58 mg/dL this morning via RPM</p></div></div>
                <div style="display: flex; gap: 0.5rem;"><button class="reengage-btn" onclick="goToPatient('Carlos Mendoza')">View Patient</button><button class="reengage-btn" style="background: rgba(45,22,40,0.2); color: var(--deep-purple);" onclick="dismissAlert('alertGlucose')">Dismiss</button></div>
            </div>
            <div class="enrollment-banner" id="alertBP">
                <div class="enrollment-info"><span class="enrollment-icon">üíì</span><div class="enrollment-text"><strong>High Blood Pressure Alert</strong><p>Ana Gutierrez BP reading 180/100 - needs immediate follow-up</p></div></div>
                <div style="display: flex; gap: 0.5rem;"><button class="reengage-btn" onclick="goToPatient('Ana Gutierrez')">View Patient</button><button class="reengage-btn" style="background: rgba(45,22,40,0.2); color: var(--deep-purple);" onclick="dismissAlert('alertBP')">Dismiss</button></div>
            </div>
            <div class="enrollment-banner" id="alertDisenroll">
                <div class="enrollment-info"><span class="enrollment-icon">üìÖ</span><div class="enrollment-text"><strong>Disenrollment Window Alert</strong><p>4 patients are within 15 days of their 90-day disenrollment window</p></div></div>
                <button class="reengage-btn" onclick="showDisenrollmentModal()">View List</button>
            </div>

            <div class="card" style="background: var(--card-bg); border-radius: 16px; padding: 1.25rem; box-shadow: 0 2px 12px rgba(45, 22, 40, 0.06);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                    <h3 class="section-title" style="margin-bottom: 0;">All Cercanos Patients</h3>
                    <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                        <input type="text" class="search-input" placeholder="Search patients..." id="globalPatientSearch" oninput="filterGlobalPatients()" style="padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.875rem; width: 250px;">
                        <button class="filter-btn" onclick="toggleGlobalFilter('disenroll')" style="padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">‚è∞ Near Disenrollment</button>
                        <button class="filter-btn" onclick="toggleGlobalFilter('onsite')" style="padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">üè• Referred for Onsite</button>
                        <button class="filter-btn" onclick="toggleGlobalFilter('alerts')" style="padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">üö® With Alerts</button>
                        <button class="filter-btn" onclick="clearGlobalFilters()" style="padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">Clear Filters</button>
                    </div>
                </div>
                <div style="max-height: 500px; overflow-y: auto;">
                    <table class="patient-table" style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                        <thead><tr style="background: var(--blush);"><th style="padding: 0.75rem; text-align: left; font-weight: 600; color: var(--deep-purple); border-bottom: 2px solid var(--border-color);">Patient Name</th><th style="padding: 0.75rem; text-align: left;">DOB</th><th style="padding: 0.75rem; text-align: left;">MRN</th><th style="padding: 0.75rem; text-align: left;">Conditions</th><th style="padding: 0.75rem; text-align: left;">PCP</th><th style="padding: 0.75rem; text-align: left;">Enrolled</th><th style="padding: 0.75rem; text-align: left;">Onsite Referral</th><th style="padding: 0.75rem; text-align: left;">Status</th></tr></thead>
                        <tbody id="globalPatientListBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PRACTICE VIEW -->
        <div class="practice-view" id="practiceView" style="display: none;">
            <!-- Practice Header -->
            <div class="card" style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <div><h2 style="color: var(--deep-purple); margin-bottom: 0.25rem;" id="practiceTitle">Centro de Salud Familiar</h2><p style="color: var(--text-secondary); font-size: 0.9rem;">245 Active Patients | 12 Providers</p></div>
                <button class="reengage-btn" onclick="showDisenrollmentModal()" style="background: var(--gold); color: var(--deep-purple);">‚è∞ 8 Near Disenrollment</button>
            </div>

            <!-- Practice Tabs -->
            <div class="pcp-tabs">
                <button class="pcp-tab active" onclick="switchPracticeTab('population')">Population Overview</button>
                <button class="pcp-tab" onclick="switchPracticeTab('engagement')">Engagement Activities</button>
                <button class="pcp-tab" onclick="switchPracticeTab('unengaged')">Unengaged Patients</button>
                <button class="pcp-tab" onclick="switchPracticeTab('vbc')">Value-Based Care</button>
            </div>

            <!-- Population Tab -->
            <div class="practice-tab-content active" id="practiceTab-population">
                <div class="practice-snapshot">
                    <div class="snapshot-tile"><div class="snapshot-value">245</div><div class="snapshot-label">Active Patients</div><div class="snapshot-delta positive">+12 this month</div></div>
                    <div class="snapshot-tile highlight"><div class="snapshot-value">68%</div><div class="snapshot-label">Overall Control</div><div class="snapshot-delta positive">‚Üë3% vs last month</div></div>
                    <div class="snapshot-tile"><div class="snapshot-value">89%</div><div class="snapshot-label">Engagement Rate</div><div class="snapshot-delta positive">‚Üë5%</div></div>
                    <div class="snapshot-tile caution" style="cursor: pointer;" onclick="showDisenrollmentModal()"><div class="snapshot-value">8</div><div class="snapshot-label">Near Disenrollment</div><div class="snapshot-delta" style="color: var(--orange);">Click to view</div></div>
                    <div class="snapshot-tile"><div class="snapshot-value">42</div><div class="snapshot-label">New This Quarter</div></div>
                    <div class="snapshot-tile"><div class="snapshot-value">4.2</div><div class="snapshot-label">Avg Touches/Mo</div></div>
                </div>

                <h3 class="section-title">Average Control by Condition</h3>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="card" style="text-align: center; padding: 1rem;"><div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">Diabetes (A1C)</div><div style="font-size: 1.5rem; font-weight: 700; color: var(--olive-green);">65%</div><div style="font-size: 0.7rem; color: var(--text-secondary);">at target (&lt;7%)</div></div>
                    <div class="card" style="text-align: center; padding: 1rem;"><div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">Hypertension (BP)</div><div style="font-size: 1.5rem; font-weight: 700; color: var(--olive-green);">72%</div><div style="font-size: 0.7rem; color: var(--text-secondary);">at target (&lt;130/80)</div></div>
                    <div class="card" style="text-align: center; padding: 1rem;"><div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">Dyslipidemia (LDL)</div><div style="font-size: 1.5rem; font-weight: 700; color: var(--olive-green);">58%</div><div style="font-size: 0.7rem; color: var(--text-secondary);">at target (&lt;100)</div></div>
                    <div class="card" style="text-align: center; padding: 1rem;"><div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">Depression (PHQ-9)</div><div style="font-size: 1.5rem; font-weight: 700; color: var(--olive-green);">61%</div><div style="font-size: 0.7rem; color: var(--text-secondary);">improved scores</div></div>
                    <div class="card" style="text-align: center; padding: 1rem;"><div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">Anxiety (GAD-7)</div><div style="font-size: 1.5rem; font-weight: 700; color: var(--olive-green);">55%</div><div style="font-size: 0.7rem; color: var(--text-secondary);">improved scores</div></div>
                </div>

                <div class="pcp-grid" style="grid-template-columns: 1fr 1.5fr;">
                    <div class="card population-section">
                        <h3 class="section-title">Population by Condition</h3>
                        <div class="condition-row"><span class="condition-name">Diabetes</span><div class="condition-bar"><div class="condition-fill" style="width: 78%; background: var(--orange);"></div></div><span class="condition-stats">192 (78%)</span></div>
                        <div class="condition-row"><span class="condition-name">Hypertension</span><div class="condition-bar"><div class="condition-fill" style="width: 65%; background: var(--purple);"></div></div><span class="condition-stats">159 (65%)</span></div>
                        <div class="condition-row"><span class="condition-name">Obesity</span><div class="condition-bar"><div class="condition-fill" style="width: 52%; background: var(--tan);"></div></div><span class="condition-stats">128 (52%)</span></div>
                        <div class="condition-row"><span class="condition-name">Dyslipidemia</span><div class="condition-bar"><div class="condition-fill" style="width: 45%; background: var(--navy-blue);"></div></div><span class="condition-stats">110 (45%)</span></div>
                        <div class="condition-row"><span class="condition-name">Depression</span><div class="condition-bar"><div class="condition-fill" style="width: 28%; background: var(--olive-green);"></div></div><span class="condition-stats">69 (28%)</span></div>
                        <div class="condition-row"><span class="condition-name">Anxiety</span><div class="condition-bar"><div class="condition-fill" style="width: 22%; background: var(--brown);"></div></div><span class="condition-stats">54 (22%)</span></div>
                        <h4>By Risk Tier</h4>
                        <div class="risk-tier high"><span class="risk-tier-label">‚óè High</span><span class="risk-tier-count">61 (25%)</span></div>
                        <div class="risk-tier medium"><span class="risk-tier-label">‚óè Medium</span><span class="risk-tier-count">110 (45%)</span></div>
                        <div class="risk-tier low"><span class="risk-tier-label">‚óè Low</span><span class="risk-tier-count">74 (30%)</span></div>
                    </div>
                    <div class="card">
                        <h3 class="section-title">Uncontrolled Patients by Condition</h3>
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">Click any row to view patient list and take action</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                            <thead><tr style="background: var(--blush);"><th style="padding: 0.6rem; text-align: left;">Condition</th><th style="padding: 0.6rem; text-align: left;">Uncontrolled</th><th style="padding: 0.6rem; text-align: left;">% of Total</th><th style="padding: 0.6rem; text-align: left;">Trend</th></tr></thead>
                            <tbody>
                                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="showUncontrolledModal('Diabetes')"><td style="padding: 0.6rem;"><span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(222, 129, 48, 0.2); color: var(--orange);">Diabetes</span></td><td style="padding: 0.6rem;"><span style="background: var(--orange); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-weight: 700;">67</span></td><td style="padding: 0.6rem;">35%</td><td style="padding: 0.6rem; color: var(--olive-green);">‚Üì5</td></tr>
                                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="showUncontrolledModal('Hypertension')"><td style="padding: 0.6rem;"><span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(101, 40, 117, 0.2); color: var(--purple);">Hypertension</span></td><td style="padding: 0.6rem;"><span style="background: var(--orange); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-weight: 700;">45</span></td><td style="padding: 0.6rem;">28%</td><td style="padding: 0.6rem; color: var(--olive-green);">‚Üì3</td></tr>
                                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="showUncontrolledModal('Dyslipidemia')"><td style="padding: 0.6rem;"><span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(47, 96, 137, 0.2); color: var(--navy-blue);">Dyslipidemia</span></td><td style="padding: 0.6rem;"><span style="background: var(--orange); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-weight: 700;">46</span></td><td style="padding: 0.6rem;">42%</td><td style="padding: 0.6rem; color: var(--orange);">‚Üë2</td></tr>
                                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="showUncontrolledModal('Depression')"><td style="padding: 0.6rem;"><span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(119, 123, 65, 0.2); color: var(--olive-green);">Depression</span></td><td style="padding: 0.6rem;"><span style="background: var(--orange); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-weight: 700;">27</span></td><td style="padding: 0.6rem;">39%</td><td style="padding: 0.6rem; color: var(--olive-green);">‚Üì4</td></tr>
                                <tr style="cursor: pointer;" onclick="showUncontrolledModal('Anxiety')"><td style="padding: 0.6rem;"><span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(90, 75, 68, 0.2); color: var(--brown);">Anxiety</span></td><td style="padding: 0.6rem;"><span style="background: var(--orange); color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-weight: 700;">24</span></td><td style="padding: 0.6rem;">45%</td><td style="padding: 0.6rem;">‚Äî</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <h3 class="section-title">Value-Based Care Metrics</h3>
                    <div class="vbc-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('A1C Control')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">65%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">A1C Control Rate</div><div style="font-size: 0.7rem; color: var(--olive-green); margin-top: 0.25rem;">Target: 70% | Gap: 12 patients</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('BP Control')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">72%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">BP Control Rate</div><div style="font-size: 0.7rem; color: var(--olive-green); margin-top: 0.25rem;">Target: 75% | Gap: 8 patients</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('Eye Exam')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">81%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">Eye Exam Compliance</div><div style="font-size: 0.7rem; color: var(--olive-green); margin-top: 0.25rem;">Target: 85% | Gap: 10 patients</div></div>
                    </div>
                </div>
            </div>

            <!-- Engagement Tab -->
            <div class="practice-tab-content" id="practiceTab-engagement" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="section-title" style="margin-bottom: 0;">Engagement Activities - All Eligible Patients</h3>
                        <div style="display: flex; gap: 0.75rem;"><input type="text" class="search-input" placeholder="Search..." style="padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; width: 200px;"><button class="filter-btn" style="padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">Pending Enrollment</button></div>
                    </div>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                            <thead><tr style="background: var(--blush);"><th style="padding: 0.6rem; text-align: left;">Patient Name</th><th style="padding: 0.6rem; text-align: left;">DOB</th><th style="padding: 0.6rem; text-align: left;">MRN</th><th style="padding: 0.6rem; text-align: left;">PCP</th><th style="padding: 0.6rem; text-align: left;">Call 1</th><th style="padding: 0.6rem; text-align: left;">Call 2</th><th style="padding: 0.6rem; text-align: left;">Call 3</th><th style="padding: 0.6rem; text-align: left;">Call 4</th><th style="padding: 0.6rem; text-align: left;">Call 5</th><th style="padding: 0.6rem; text-align: left;">Enrollment</th></tr></thead>
                            <tbody id="engagementTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Unengaged Tab -->
            <div class="practice-tab-content" id="practiceTab-unengaged" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="section-title" style="margin-bottom: 0;">Unengaged Patients - PCP Referrals Pending Enrollment</h3>
                        <div style="display: flex; gap: 0.75rem;"><input type="text" class="search-input" placeholder="Search..." style="padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; width: 200px;"><button class="filter-btn active" style="padding: 0.4rem 0.8rem; border: 1px solid var(--orange); background: var(--orange); color: white; border-radius: 20px; font-size: 0.75rem; cursor: pointer;">All Unengaged</button></div>
                    </div>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                            <thead><tr style="background: var(--blush);"><th style="padding: 0.75rem; text-align: left;">Patient Name</th><th style="padding: 0.75rem; text-align: left;">DOB</th><th style="padding: 0.75rem; text-align: left;">MRN</th><th style="padding: 0.75rem; text-align: left;">Conditions</th><th style="padding: 0.75rem; text-align: left;">PCP</th><th style="padding: 0.75rem; text-align: left;">Referred Date</th><th style="padding: 0.75rem; text-align: left;">Last Contact</th><th style="padding: 0.75rem; text-align: left;">Status</th></tr></thead>
                            <tbody id="unengagedTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VBC Tab -->
            <div class="practice-tab-content" id="practiceTab-vbc" style="display: none;">
                <div class="card">
                    <h3 class="section-title">Value-Based Care Performance Dashboard</h3>
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1.5rem;">Click any metric to view patient list with pending activities. Export available for each measure.</p>
                    <div class="vbc-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('A1C Control')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">65%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">A1C &lt; 7% (Diabetics)</div><div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">125 of 192 | Target: 70%</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('BP Control')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">72%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">BP &lt; 130/80</div><div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">114 of 159 | Target: 75%</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('LDL Control')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">58%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">LDL &lt; 100</div><div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">64 of 110 | Target: 65%</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('Eye Exam')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">81%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">Annual Eye Exam</div><div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">156 of 192 | Target: 85%</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('Kidney Screening')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">78%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">Annual Kidney Screening</div><div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">150 of 192 | Target: 80%</div></div>
                        <div class="vbc-card" style="background: var(--blush); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer;" onclick="showVBCModal('Statin Therapy')"><div style="font-size: 1.5rem; font-weight: 700; color: var(--deep-purple);">85%</div><div style="font-size: 0.75rem; color: var(--text-secondary);">Statin Therapy (ASCVD)</div><div style="font-size: 0.7rem; color: var(--olive-green); margin-top: 0.25rem;">94 of 110 | ‚úì Target Met</div></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MODALS -->
    <div class="modal-overlay" id="careTeamModal" onclick="closeCareTeamModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header"><h3>Care Team Interactions (12 Visits)</h3><button class="modal-close" onclick="closeCareTeamModal()">√ó</button></div>
            <div class="modal-body">
                <div class="care-team-group"><div class="care-team-role">üéØ Care Coach <span class="count">5 visits</span></div><div class="care-team-member"><div><div class="member-name">Ana Martinez</div><div class="member-last-visit">Last: Jan 25, 2026</div></div></div></div>
                <div class="care-team-group"><div class="care-team-role">ü•ó Nutritionist <span class="count">3 visits</span></div><div class="care-team-member"><div><div class="member-name">Carmen Delgado, RD</div><div class="member-last-visit">Last: Jan 18, 2026</div></div></div></div>
                <div class="care-team-group"><div class="care-team-role">üíä Pharmacist <span class="count">2 visits</span></div><div class="care-team-member"><div><div class="member-name">David Chen, PharmD</div><div class="member-last-visit">Last: Jan 10, 2026</div></div></div></div>
                <div class="care-team-group"><div class="care-team-role">ü©∫ RN Educator <span class="count">1 visit</span></div><div class="care-team-member"><div><div class="member-name">Lisa Thompson, RN</div><div class="member-last-visit">Last: Jan 5, 2026</div></div></div></div>
                <div class="care-team-group"><div class="care-team-role">üë®‚Äç‚öïÔ∏è Provider <span class="count">1 review</span></div><div class="care-team-member"><div><div class="member-name">Dr. Garc√≠a</div><div class="member-last-visit">Last: Dec 28, 2025</div></div></div></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="glucoseModal" onclick="closeGlucoseModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header"><h3>üìä Last 10 Glucose Readings (RPM)</h3><button class="modal-close" onclick="closeGlucoseModal()">√ó</button></div>
            <div class="modal-body">
                <table class="glucose-table"><thead><tr><th>Date/Time</th><th>Reading</th><th>Context</th><th>Source</th></tr></thead>
                <tbody>
                    <tr><td>Jan 27, 8:15 AM</td><td><span class="glucose-value normal">112 mg/dL</span></td><td>Fasting</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 26, 7:45 PM</td><td><span class="glucose-value normal">145 mg/dL</span></td><td>Post-meal</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 26, 7:30 AM</td><td><span class="glucose-value normal">108 mg/dL</span></td><td>Fasting</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 25, 9:00 PM</td><td><span class="glucose-value high">178 mg/dL</span></td><td>Post-meal</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 25, 7:15 AM</td><td><span class="glucose-value normal">98 mg/dL</span></td><td>Fasting</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 24, 8:30 PM</td><td><span class="glucose-value normal">134 mg/dL</span></td><td>Post-meal</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 24, 7:00 AM</td><td><span class="glucose-value normal">105 mg/dL</span></td><td>Fasting</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 23, 3:15 PM</td><td><span class="glucose-value low">62 mg/dL</span></td><td>Pre-meal</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 23, 7:45 AM</td><td><span class="glucose-value normal">118 mg/dL</span></td><td>Fasting</td><td class="glucose-source">Glucometer</td></tr>
                    <tr><td>Jan 22, 8:00 PM</td><td><span class="glucose-value normal">142 mg/dL</span></td><td>Post-meal</td><td class="glucose-source">Glucometer</td></tr>
                </tbody></table>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(222, 129, 48, 0.1); border-radius: 8px; font-size: 0.8rem;">
                    <strong style="color: var(--orange);">‚ö†Ô∏è Alert:</strong> Low reading Jan 23 (62 mg/dL). Patient reported mild hypoglycemia.
                </div>
            </div>
        </div>
    </div>

    <!-- Utilization Sidebar -->
    <div class="sidebar-overlay" id="utilSidebarOverlay" onclick="closeUtilSidebar()"></div>
    <div class="sidebar" id="utilSidebar">
        <div class="sidebar-header util"><h3>üè• Healthcare Utilization (12 Mo)</h3><button class="sidebar-close" onclick="closeUtilSidebar()">√ó</button></div>
        <div class="sidebar-content">
            <div class="util-summary">
                <div class="util-summary-card"><div class="util-summary-icon">üö®</div><div class="util-summary-value">2</div><div class="util-summary-label">ER Visits</div></div>
                <div class="util-summary-card"><div class="util-summary-icon">üè•</div><div class="util-summary-value">1</div><div class="util-summary-label">Hospital</div></div>
                <div class="util-summary-card"><div class="util-summary-icon">üë®‚Äç‚öïÔ∏è</div><div class="util-summary-value">4</div><div class="util-summary-label">Specialist</div></div>
            </div>
            <h4 style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">TIMELINE</h4>
            <div class="util-timeline">
                <div class="util-event er"><div class="util-event-header"><span class="util-event-type">ER Visit</span><span class="util-event-date">Jan 14, 2026</span></div><div class="util-event-title">Hypoglycemia Episode</div><div class="util-event-details">BG 54 mg/dL. Treated, discharged same day.</div></div>
                <div class="util-event specialist"><div class="util-event-header"><span class="util-event-type">Specialist</span><span class="util-event-date">Dec 15, 2025</span></div><div class="util-event-title">Ophthalmology - Eye Exam</div><div class="util-event-details">No diabetic retinopathy. Follow-up 12 mo.</div></div>
                <div class="util-event specialist"><div class="util-event-header"><span class="util-event-type">Specialist</span><span class="util-event-date">Nov 8, 2025</span></div><div class="util-event-title">Cardiology Evaluation</div><div class="util-event-details">Stress test normal. Continue statin.</div></div>
                <div class="util-event hospital"><div class="util-event-header"><span class="util-event-type">Hospital</span><span class="util-event-date">Sep 22, 2025</span></div><div class="util-event-title">Chest Pain Observation (2d)</div><div class="util-event-details">Troponins negative. Discharged stable.</div></div>
                <div class="util-event er"><div class="util-event-header"><span class="util-event-type">ER Visit</span><span class="util-event-date">Aug 5, 2025</span></div><div class="util-event-title">Elevated Blood Pressure</div><div class="util-event-details">BP 185/110. Stabilized. Referred to Cercanos.</div></div>
                <div class="util-event specialist"><div class="util-event-header"><span class="util-event-type">Specialist</span><span class="util-event-date">Jul 12, 2025</span></div><div class="util-event-title">Nephrology Review</div><div class="util-event-details">eGFR 75, CKD stage 2. ACE started.</div></div>
                <div class="util-event specialist"><div class="util-event-header"><span class="util-event-type">Specialist</span><span class="util-event-date">Apr 20, 2025</span></div><div class="util-event-title">Podiatry - Foot Exam</div><div class="util-event-details">Monofilament normal. Footwear education.</div></div>
            </div>
        </div>
    </div>

    <!-- SDOH Sidebar -->
    <div class="sidebar-overlay" id="sdohSidebarOverlay" onclick="closeSDOHSidebar()"></div>
    <div class="sidebar" id="sdohSidebar">
        <div class="sidebar-header sdoh"><h3>üìã Social Determinants of Health</h3><button class="sidebar-close" onclick="closeSDOHSidebar()">√ó</button></div>
        <div class="sidebar-content">
            <div class="sdoh-section">
                <div class="sdoh-section-title">üíº Employment & Income</div>
                <div class="sdoh-row"><span class="sdoh-label">Employment Status</span><span class="sdoh-badge status-concern">Unemployed</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Last Employment</span><span class="sdoh-value">Jan 14, 2026</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Previous Employer</span><span class="sdoh-value">Martinez Construction</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Income Stability</span><span class="sdoh-badge risk-high">At Risk</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üìç Neighborhood & Environment</div>
                <div class="sdoh-row"><span class="sdoh-label">ZIP Code</span><span class="sdoh-value">78207</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Area Deprivation Index</span><span class="sdoh-badge risk-high">High Need</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Food Desert</span><span class="sdoh-badge status-concern">Yes</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Healthcare Access</span><span class="sdoh-badge risk-medium">Limited</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üöó Transportation</div>
                <div class="sdoh-row"><span class="sdoh-label">Has Vehicle</span><span class="sdoh-value">Yes (shared)</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Transportation Barrier</span><span class="sdoh-badge risk-medium">Moderate</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Rideshare Access</span><span class="sdoh-badge status-ok">Available</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üè• Insurance & Coverage</div>
                <div class="sdoh-row"><span class="sdoh-label">Insurance Status</span><span class="sdoh-badge status-ok">Insured</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Coverage Type</span><span class="sdoh-value">Medicare + Medicaid</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Medication Assistance</span><span class="sdoh-badge status-ok">Enrolled</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Copay Barrier</span><span class="sdoh-badge risk-low">Low</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üè† Housing & Living</div>
                <div class="sdoh-row"><span class="sdoh-label">Housing Status</span><span class="sdoh-badge status-ok">Stable</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Living Situation</span><span class="sdoh-value">With family</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Utility Concerns</span><span class="sdoh-badge risk-low">None</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üçé Food Security</div>
                <div class="sdoh-row"><span class="sdoh-label">Food Insecurity</span><span class="sdoh-badge risk-medium">Moderate</span></div>
                <div class="sdoh-row"><span class="sdoh-label">SNAP Benefits</span><span class="sdoh-badge status-ok">Enrolled</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Access to Healthy Food</span><span class="sdoh-badge risk-medium">Limited</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üë• Social Support</div>
                <div class="sdoh-row"><span class="sdoh-label">Social Isolation</span><span class="sdoh-badge risk-low">Low</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Caregiver Support</span><span class="sdoh-value">Spouse assists</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Community Resources</span><span class="sdoh-badge status-ok">Connected</span></div>
            </div>
            <div class="sdoh-section">
                <div class="sdoh-section-title">üìö Health Literacy</div>
                <div class="sdoh-row"><span class="sdoh-label">Health Literacy Level</span><span class="sdoh-badge risk-medium">Moderate</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Primary Language</span><span class="sdoh-value">Spanish</span></div>
                <div class="sdoh-row"><span class="sdoh-label">Interpreter Needed</span><span class="sdoh-badge status-concern">Sometimes</span></div>
            </div>
            <div class="sdoh-note">
                <strong>Care Team Note:</strong> Patient recently lost employment. Enrolled in medication assistance program Jan 16. Transportation may be barrier for appointments - consider telehealth options. Spanish-language materials preferred.
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-logo">
            <img src="heart_icon.png" alt="Cercanos Heart" class="footer-heart">
            <img src="Logo_Cercanos_Green.png" alt="cercanos" class="footer-wordmark">
        </div>
        <p class="footer-tagline">connecting care &amp; community</p>
        <p>Dashboard last updated: January 28, 2026 at 2:45 PM</p>
    </footer>

    <script>
        const patients = [
            { name: "Roberto Hern√°ndez", conditions: ["Diabetes", "HTN"], risk: "high", a1c: 7.2, bp: "142/88", trend: "down", phase: "Active", lastTouch: "Jan 25", flags: ["PCP review"] },
            { name: "Mar√≠a Santos", conditions: ["HTN", "Obesity"], risk: "high", a1c: 6.1, bp: "156/94", trend: "stable", phase: "Active", lastTouch: "Jan 20", flags: ["BP elevated"] },
            { name: "Carlos Mendoza", conditions: ["Diabetes", "Obesity"], risk: "medium", a1c: 7.8, bp: "128/82", trend: "down", phase: "Active", lastTouch: "Jan 22", flags: ["Med question"] },
            { name: "Ana Garc√≠a", conditions: ["Diabetes"], risk: "low", a1c: 6.4, bp: "122/78", trend: "down", phase: "Maintenance", lastTouch: "Jan 15", flags: [] },
            { name: "Jos√© Ram√≠rez", conditions: ["Diabetes", "HTN", "Obesity"], risk: "high", a1c: 9.1, bp: "148/92", trend: "down", phase: "Active", lastTouch: "Jan 26", flags: ["Labs overdue"] },
            { name: "Teresa L√≥pez", conditions: ["Prediabetes", "Obesity"], risk: "medium", a1c: 5.9, bp: "118/76", trend: "down", phase: "Active", lastTouch: "Jan 24", flags: [] },
            { name: "Miguel Flores", conditions: ["Diabetes", "HTN"], risk: "medium", a1c: 7.5, bp: "136/84", trend: "stable", phase: "Active", lastTouch: "Jan 21", flags: [] },
            { name: "Elena V√°squez", conditions: ["HTN"], risk: "low", a1c: 5.4, bp: "124/80", trend: "down", phase: "Maintenance", lastTouch: "Jan 10", flags: [] },
            { name: "Pedro Ortiz", conditions: ["Diabetes", "Obesity"], risk: "high", a1c: 8.4, bp: "138/86", trend: "down", phase: "Active", lastTouch: "Jan 27", flags: ["Engagement"] },
            { name: "Isabel Cruz", conditions: ["Diabetes", "HTN"], risk: "medium", a1c: 7.1, bp: "132/82", trend: "down", phase: "Active", lastTouch: "Jan 23", flags: [] },
            { name: "Fernando Reyes", conditions: ["Prediabetes"], risk: "low", a1c: 5.8, bp: "120/78", trend: "down", phase: "Active", lastTouch: "Jan 19", flags: [] },
            { name: "Luc√≠a Morales", conditions: ["Diabetes", "HTN", "Obesity"], risk: "high", a1c: 8.8, bp: "144/90", trend: "down", phase: "Onboarding", lastTouch: "Jan 26", flags: ["New"] }
        ];

        const segments = [
            { id: 'wellbeing', label: 'Psychological\nWell-being', color: '#2f6089' },
            { id: 'distress', label: 'Diabetes\nDistress', color: '#2f6089' },
            { id: 'depression', label: 'Depression', color: '#2f6089' },
            { id: 'dka', label: 'Diabetic\nKetoacidosis', color: '#777b41' },
            { id: 'hhs', label: 'Hyperglycemic\nSyndrome', color: '#777b41' },
            { id: 'hypo', label: 'Hypoglycemia', color: '#777b41' },
            { id: 'vascular', label: 'Micro/Macro\nVascular', color: '#de8130' },
            { id: 'neuro', label: 'Nervous\nSystem', color: '#de8130' },
            { id: 'treatment', label: 'Treatment\nComplications', color: '#de8130' },
            { id: 'vital', label: 'Vital\nStatus', color: '#a47864' },
            { id: 'barriers', label: 'Financial\nBarriers', color: '#a47864' },
            { id: 'utilization', label: 'Healthcare\nUtilization', color: '#e6d9d3' },
            { id: 'glycemic', label: 'Glycemic\nControl', color: '#f3bf57' }
        ];

        const metricsData = {
            hypo: { category: 'ACUTE EVENTS', name: 'Hypoglycemia Episodes', value: '1 mild', target: 'Target: 0 severe | Last: 3 total (Oct 2025)', status: 'Good', statusClass: 'status-good', progress: 85, btnText: 'üìä View Last 10 Glucose Readings', btnAction: 'openGlucoseModal', showExam: false, showPRO: false },
            dka: { category: 'ACUTE EVENTS', name: 'Diabetic Ketoacidosis', value: '0 events', target: '12-month lookback: No events', status: 'On Target', statusClass: 'status-excellent', progress: 100, btnText: null, showExam: false, showPRO: false },
            hhs: { category: 'ACUTE EVENTS', name: 'Hyperglycemic Hyperosmolar Syndrome', value: '0 events', target: '12-month lookback: No events', status: 'On Target', statusClass: 'status-excellent', progress: 100, btnText: null, showExam: false, showPRO: false },
            vascular: { category: 'CHRONIC COMPLICATIONS', name: 'Micro/Macrovascular Complications', value: 'Stable', target: 'Monitoring: Retinopathy, Nephropathy', status: 'Monitoring', statusClass: 'status-caution', progress: 70, btnText: null, showExam: true, showPRO: false, exam1: { label: 'Last Eye Exam', date: 'Dec 15, 2025', result: 'No retinopathy' }, exam2: { label: 'Last Kidney Test', date: 'Jan 8, 2026', result: 'eGFR: 72 mL/min' } },
            neuro: { category: 'CHRONIC COMPLICATIONS', name: 'Nervous System Complications', value: 'Mild neuropathy', target: 'Annual screening completed', status: 'Stable', statusClass: 'status-attention', progress: 60, btnText: null, showExam: true, showPRO: false, exam1: { label: 'Last Foot Exam', date: 'Apr 20, 2025', result: 'Monofilament normal' }, exam2: { label: 'Next Due', date: 'Apr 2026', result: 'Schedule podiatry' } },
            treatment: { category: 'CHRONIC COMPLICATIONS', name: 'Treatment Complications', value: 'None', target: 'No adverse events reported', status: 'On Target', statusClass: 'status-excellent', progress: 100, btnText: null, showExam: false, showPRO: false },
            wellbeing: { category: 'PATIENT-REPORTED', name: 'Patient-Reported Outcomes', value: '68%', target: 'Combined PRO score from WHO-5, PAID, PHQ-9', status: 'Good', statusClass: 'status-good', progress: 68, btnText: null, showExam: false, showPRO: true },
            distress: { category: 'PATIENT-REPORTED', name: 'Patient-Reported Outcomes', value: '68%', target: 'Combined PRO score from WHO-5, PAID, PHQ-9', status: 'Good', statusClass: 'status-good', progress: 68, btnText: null, showExam: false, showPRO: true },
            depression: { category: 'PATIENT-REPORTED', name: 'Patient-Reported Outcomes', value: '68%', target: 'Combined PRO score from WHO-5, PAID, PHQ-9', status: 'Good', statusClass: 'status-good', progress: 68, btnText: null, showExam: false, showPRO: true },
            vital: { category: 'SURVIVAL', name: 'Vital Status', value: 'Active', target: 'Engaged in care program', status: 'Active', statusClass: 'status-excellent', progress: 100, btnText: null, showExam: false, showPRO: false },
            barriers: { category: 'HEALTH SERVICES', name: 'Financial Barriers / SDOH', value: 'Unemployed', target: 'Job loss Jan 14, 2026 | Med assistance enrolled', status: 'Needs Support', statusClass: 'status-attention', progress: 40, btnText: 'üìã View All SDOH Factors', btnAction: 'openSDOHSidebar', showExam: false, showPRO: false },
            utilization: { category: 'HEALTH SERVICES', name: 'Healthcare Utilization', value: '1 ER Visit', target: 'Jan 14, 2026 (hypoglycemia)', status: 'Monitor', statusClass: 'status-caution', progress: 65, btnText: 'üìã View 12-Month History', btnAction: 'openUtilSidebar', showExam: false, showPRO: false },
            glycemic: { category: 'METABOLIC CONTROL', name: 'Glycemic Control (A1C)', value: '7.2%', target: 'Target: <7.0% | Improved from 7.8%', status: 'Improving', statusClass: 'status-caution', progress: 85, btnText: null, showExam: false, showPRO: false }
        };

        let canvas, ctx, selectedSegment = 'hypo', hoveredSegment = null;

        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('wheelCanvas');
            if (canvas) { ctx = canvas.getContext('2d'); initWheel(); }
            populatePatientTable();
            selectMetric('hypo');
        });

        function switchView(view) {
            // Update toggle buttons
            document.getElementById('patientListBtn').classList.toggle('active', view === 'patientList');
            document.getElementById('patientViewBtn').classList.toggle('active', view === 'patient');
            document.getElementById('practiceViewBtn').classList.toggle('active', view === 'practice');

            // Show/hide views
            document.getElementById('patientView').style.display = view === 'patient' ? 'block' : 'none';
            document.getElementById('patientListView').style.display = view === 'patientList' ? 'block' : 'none';
            document.getElementById('practiceView').style.display = view === 'practice' ? 'block' : 'none';

            // Show/hide practice selector
            document.getElementById('practiceSelectorContainer').style.display = view === 'practice' ? 'flex' : 'none';

            // Populate tables when switching to those views
            if (view === 'patientList') populateGlobalPatientList();
            if (view === 'practice') { populateEngagementTable(); populateUnengagedTable(); }
        }

        function switchPracticeTab(tabId) {
            document.querySelectorAll('.pcp-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.practice-tab-content').forEach(c => c.style.display = 'none');
            event.target.classList.add('active');
            document.getElementById(`practiceTab-${tabId}`).style.display = 'block';
            if (tabId === 'engagement') populateEngagementTable();
            if (tabId === 'unengaged') populateUnengagedTable();
        }

        function changePractice() {
            const practice = document.getElementById('practiceDropdown').value;
            const titles = { 'centro': 'Centro de Salud Familiar', 'clinica': 'Cl√≠nica del Valle', 'medicina': 'Medicina Integral San Antonio' };
            document.getElementById('practiceTitle').textContent = titles[practice];
        }

        // Global Patient List (20 patients)
        const globalPatients = [
            { name: "Roberto Hern√°ndez", dob: "03/15/1962", mrn: "847293", conditions: ["Diabetes", "HTN"], pcp: "Dr. Garc√≠a", enrolled: "Oct 15, 2025", onsite: false, daysToDisenroll: 5, alert: null },
            { name: "Maria Santos", dob: "07/22/1958", mrn: "823451", conditions: ["Diabetes", "Obesity"], pcp: "Dr. Mart√≠nez", enrolled: "Nov 02, 2025", onsite: true, daysToDisenroll: 45, alert: "ER Visit" },
            { name: "Carlos Mendoza", dob: "11/08/1970", mrn: "891234", conditions: ["Diabetes"], pcp: "Dr. Garc√≠a", enrolled: "Sep 28, 2025", onsite: false, daysToDisenroll: 60, alert: "Low Glucose" },
            { name: "Ana Gutierrez", dob: "04/30/1965", mrn: "856789", conditions: ["HTN", "Dyslipidemia"], pcp: "Dr. L√≥pez", enrolled: "Dec 01, 2025", onsite: false, daysToDisenroll: 58, alert: "High BP" },
            { name: "Carmen Flores", dob: "09/14/1972", mrn: "834567", conditions: ["Diabetes", "HTN", "Depression"], pcp: "Dr. Mart√≠nez", enrolled: "Oct 18, 2025", onsite: true, daysToDisenroll: 8, alert: null },
            { name: "Miguel Ramos", dob: "02/28/1968", mrn: "812345", conditions: ["Diabetes", "Obesity"], pcp: "Dr. Garc√≠a", enrolled: "Oct 22, 2025", onsite: false, daysToDisenroll: 12, alert: null },
            { name: "Elena V√°squez", dob: "06/05/1975", mrn: "878901", conditions: ["HTN", "Anxiety"], pcp: "Dr. L√≥pez", enrolled: "Oct 25, 2025", onsite: false, daysToDisenroll: 15, alert: null },
            { name: "Jos√© Morales", dob: "12/17/1960", mrn: "845678", conditions: ["Diabetes", "HTN", "Dyslipidemia"], pcp: "Dr. Garc√≠a", enrolled: "Aug 15, 2025", onsite: true, daysToDisenroll: 120, alert: null },
            { name: "Rosa Delgado", dob: "08/23/1963", mrn: "867890", conditions: ["Diabetes", "Depression"], pcp: "Dr. Mart√≠nez", enrolled: "Sep 10, 2025", onsite: false, daysToDisenroll: 90, alert: null },
            { name: "Fernando Ortiz", dob: "01/11/1971", mrn: "823456", conditions: ["Obesity", "Anxiety"], pcp: "Dr. L√≥pez", enrolled: "Nov 20, 2025", onsite: false, daysToDisenroll: 48, alert: null },
            { name: "Patricia Luna", dob: "05/19/1967", mrn: "889012", conditions: ["Diabetes", "HTN"], pcp: "Dr. Garc√≠a", enrolled: "Jul 05, 2025", onsite: true, daysToDisenroll: 150, alert: null },
            { name: "Ricardo Silva", dob: "10/02/1959", mrn: "856123", conditions: ["HTN", "Dyslipidemia", "Obesity"], pcp: "Dr. Mart√≠nez", enrolled: "Dec 10, 2025", onsite: false, daysToDisenroll: 52, alert: null },
            { name: "Lucia Herrera", dob: "03/27/1973", mrn: "834789", conditions: ["Diabetes"], pcp: "Dr. L√≥pez", enrolled: "Oct 01, 2025", onsite: false, daysToDisenroll: 28, alert: null },
            { name: "Antonio Reyes", dob: "07/08/1966", mrn: "812678", conditions: ["Diabetes", "HTN", "Depression"], pcp: "Dr. Garc√≠a", enrolled: "Nov 15, 2025", onsite: true, daysToDisenroll: 42, alert: null },
            { name: "Isabel Castillo", dob: "11/29/1969", mrn: "878234", conditions: ["HTN", "Anxiety"], pcp: "Dr. Mart√≠nez", enrolled: "Sep 05, 2025", onsite: false, daysToDisenroll: 95, alert: null },
            { name: "Manuel Jim√©nez", dob: "04/14/1961", mrn: "845901", conditions: ["Diabetes", "Obesity", "Dyslipidemia"], pcp: "Dr. L√≥pez", enrolled: "Aug 28, 2025", onsite: false, daysToDisenroll: 110, alert: null },
            { name: "Gabriela Ruiz", dob: "09/06/1974", mrn: "867345", conditions: ["Diabetes", "HTN"], pcp: "Dr. Garc√≠a", enrolled: "Dec 15, 2025", onsite: true, daysToDisenroll: 47, alert: null },
            { name: "David Pe√±a", dob: "02/20/1957", mrn: "823890", conditions: ["HTN", "Dyslipidemia"], pcp: "Dr. Mart√≠nez", enrolled: "Jul 20, 2025", onsite: false, daysToDisenroll: 140, alert: null },
            { name: "Sandra Torres", dob: "06/12/1976", mrn: "889567", conditions: ["Diabetes", "Depression", "Anxiety"], pcp: "Dr. L√≥pez", enrolled: "Nov 08, 2025", onsite: false, daysToDisenroll: 38, alert: null },
            { name: "Alejandro Vargas", dob: "08/31/1964", mrn: "856456", conditions: ["Diabetes", "HTN", "Obesity"], pcp: "Dr. Garc√≠a", enrolled: "Oct 08, 2025", onsite: true, daysToDisenroll: 18, alert: null }
        ];

        const unengagedPatients = [
            { name: "Jorge Medina", dob: "05/12/1965", mrn: "901234", conditions: ["Diabetes", "HTN"], pcp: "Dr. Garc√≠a", referred: "Jan 10, 2026", lastContact: "Jan 15, 2026", status: "Voicemail left" },
            { name: "Laura Espinoza", dob: "09/28/1970", mrn: "902345", conditions: ["Diabetes"], pcp: "Dr. Mart√≠nez", referred: "Jan 05, 2026", lastContact: "Jan 12, 2026", status: "Wrong number" },
            { name: "Pedro S√°nchez", dob: "03/04/1968", mrn: "903456", conditions: ["HTN", "Obesity"], pcp: "Dr. L√≥pez", referred: "Jan 08, 2026", lastContact: "Jan 18, 2026", status: "Call back requested" },
            { name: "Teresa Gonz√°lez", dob: "11/16/1972", mrn: "904567", conditions: ["Diabetes", "Depression"], pcp: "Dr. Garc√≠a", referred: "Jan 12, 2026", lastContact: "‚Äî", status: "No contact yet" },
            { name: "Francisco D√≠az", dob: "07/22/1963", mrn: "905678", conditions: ["Diabetes", "Dyslipidemia"], pcp: "Dr. Mart√≠nez", referred: "Jan 02, 2026", lastContact: "Jan 20, 2026", status: "Declined" },
            { name: "Monica R√≠os", dob: "01/30/1975", mrn: "906789", conditions: ["HTN"], pcp: "Dr. L√≥pez", referred: "Jan 15, 2026", lastContact: "‚Äî", status: "No contact yet" },
            { name: "Ra√∫l Campos", dob: "04/08/1960", mrn: "907890", conditions: ["Diabetes", "HTN", "Anxiety"], pcp: "Dr. Garc√≠a", referred: "Jan 03, 2026", lastContact: "Jan 10, 2026", status: "Not interested" },
            { name: "Adriana Vega", dob: "08/19/1969", mrn: "908901", conditions: ["Obesity", "Depression"], pcp: "Dr. Mart√≠nez", referred: "Jan 18, 2026", lastContact: "Jan 22, 2026", status: "Scheduled callback" }
        ];

        const engagementData = [
            { name: "Jorge Medina", dob: "05/12/1965", mrn: "901234", pcp: "Dr. Garc√≠a", calls: ["Jan 10", "Jan 15", "", "", ""], enrollment: "Pending" },
            { name: "Laura Espinoza", dob: "09/28/1970", mrn: "902345", pcp: "Dr. Mart√≠nez", calls: ["Jan 05", "Jan 08", "Jan 12", "", ""], enrollment: "Pending" },
            { name: "Pedro S√°nchez", dob: "03/04/1968", mrn: "903456", pcp: "Dr. L√≥pez", calls: ["Jan 08", "Jan 14", "Jan 18", "", ""], enrollment: "Pending" },
            { name: "Teresa Gonz√°lez", dob: "11/16/1972", mrn: "904567", pcp: "Dr. Garc√≠a", calls: ["", "", "", "", ""], enrollment: "Pending" },
            { name: "Francisco D√≠az", dob: "07/22/1963", mrn: "905678", pcp: "Dr. Mart√≠nez", calls: ["Jan 02", "Jan 08", "Jan 15", "Jan 20", ""], enrollment: "Declined" },
            { name: "Roberto Hern√°ndez", dob: "03/15/1962", mrn: "847293", pcp: "Dr. Garc√≠a", calls: ["Sep 28", "Oct 02", "Oct 10", "Oct 15", ""], enrollment: "Enrolled" },
            { name: "Maria Santos", dob: "07/22/1958", mrn: "823451", pcp: "Dr. Mart√≠nez", calls: ["Oct 25", "Oct 28", "Nov 02", "", ""], enrollment: "Enrolled" }
        ];

        function populateGlobalPatientList(patientsToShow = globalPatients) {
            const tbody = document.getElementById('globalPatientListBody');
            tbody.innerHTML = patientsToShow.map(p => {
                const conditionTags = p.conditions.map(c => `<span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(222, 129, 48, 0.2); color: var(--orange); margin-right: 0.25rem;">${c}</span>`).join('');
                const alertBadge = p.alert ? `<span style="background: rgba(232, 93, 93, 0.15); color: #c44d4d; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.65rem; font-weight: 600;">üö® ${p.alert}</span>` : '';
                const disenrollBadge = p.daysToDisenroll <= 15 ? `<span style="background: linear-gradient(90deg, var(--gold) 0%, #e6a832 100%); color: var(--deep-purple); padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.65rem; font-weight: 700;">‚è∞ ${p.daysToDisenroll}d</span>` : '';
                const onsiteBadge = p.onsite ? `<span style="background: rgba(101, 40, 117, 0.15); color: var(--purple); padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.65rem; font-weight: 600;">üè• Referred</span>` : '‚Äî';
                const statusBadge = !p.alert && p.daysToDisenroll > 15 ? `<span style="background: rgba(119, 123, 65, 0.15); color: var(--olive-green); padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.65rem; font-weight: 600;">Active</span>` : '';
                return `<tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="goToPatient('${p.name}')"><td style="padding: 0.75rem;"><strong>${p.name}</strong></td><td style="padding: 0.75rem;">${p.dob}</td><td style="padding: 0.75rem;">${p.mrn}</td><td style="padding: 0.75rem;">${conditionTags}</td><td style="padding: 0.75rem;">${p.pcp}</td><td style="padding: 0.75rem;">${p.enrolled}</td><td style="padding: 0.75rem;">${onsiteBadge}</td><td style="padding: 0.75rem;">${disenrollBadge} ${alertBadge} ${statusBadge}</td></tr>`;
            }).join('');
        }

        function populateEngagementTable() {
            const tbody = document.getElementById('engagementTableBody');
            tbody.innerHTML = engagementData.map(p => {
                const callCells = p.calls.map(c => `<td style="padding: 0.6rem; border-bottom: 1px solid var(--border-color);"><span style="font-size: 0.75rem; color: ${c ? 'var(--olive-green)' : 'var(--border-color)'}; ${!c ? 'font-style: italic;' : ''}">${c || '‚Äî'}</span></td>`).join('');
                const enrollColor = p.enrollment === 'Enrolled' ? 'var(--olive-green)' : (p.enrollment === 'Declined' ? '#c44d4d' : '#b8860b');
                const enrollBg = p.enrollment === 'Enrolled' ? 'rgba(119, 123, 65, 0.15)' : (p.enrollment === 'Declined' ? 'rgba(232, 93, 93, 0.15)' : 'rgba(243, 191, 87, 0.2)');
                return `<tr style="border-bottom: 1px solid var(--border-color);"><td style="padding: 0.6rem;"><strong>${p.name}</strong></td><td style="padding: 0.6rem;">${p.dob}</td><td style="padding: 0.6rem;">${p.mrn}</td><td style="padding: 0.6rem;">${p.pcp}</td>${callCells}<td style="padding: 0.6rem;"><span style="padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: ${enrollBg}; color: ${enrollColor};">${p.enrollment}</span></td></tr>`;
            }).join('');
        }

        function populateUnengagedTable() {
            const tbody = document.getElementById('unengagedTableBody');
            tbody.innerHTML = unengagedPatients.map(p => {
                const conditionTags = p.conditions.map(c => `<span style="padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: rgba(222, 129, 48, 0.2); color: var(--orange); margin-right: 0.25rem;">${c}</span>`).join('');
                const statusColor = p.status.includes('No contact') ? 'rgba(232, 93, 93, 0.15)' : 'rgba(243, 191, 87, 0.2)';
                const statusTextColor = p.status.includes('No contact') ? '#c44d4d' : '#b8860b';
                return `<tr style="border-bottom: 1px solid var(--border-color);"><td style="padding: 0.75rem;"><strong>${p.name}</strong></td><td style="padding: 0.75rem;">${p.dob}</td><td style="padding: 0.75rem;">${p.mrn}</td><td style="padding: 0.75rem;">${conditionTags}</td><td style="padding: 0.75rem;">${p.pcp}</td><td style="padding: 0.75rem;">${p.referred}</td><td style="padding: 0.75rem;">${p.lastContact}</td><td style="padding: 0.75rem;"><span style="display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; background: ${statusColor}; color: ${statusTextColor};">${p.status}</span></td></tr>`;
            }).join('');
        }

        function filterGlobalPatients() {
            const search = document.getElementById('globalPatientSearch').value.toLowerCase();
            const filtered = globalPatients.filter(p => p.name.toLowerCase().includes(search) || p.mrn.includes(search) || p.pcp.toLowerCase().includes(search));
            populateGlobalPatientList(filtered);
        }

        function toggleGlobalFilter(type) {
            let filtered = globalPatients;
            if (type === 'disenroll') filtered = globalPatients.filter(p => p.daysToDisenroll <= 15);
            if (type === 'onsite') filtered = globalPatients.filter(p => p.onsite);
            if (type === 'alerts') filtered = globalPatients.filter(p => p.alert);
            populateGlobalPatientList(filtered);
        }

        function clearGlobalFilters() {
            document.getElementById('globalPatientSearch').value = '';
            populateGlobalPatientList();
        }

        function goToPatient(name) {
            switchView('patient');
        }

        function dismissAlert(id) {
            document.getElementById(id).style.display = 'none';
        }

        function showDisenrollmentModal() {
            alert('Disenrollment Modal - 4 patients within 15 days of 90-day window:\\n- Roberto Hern√°ndez (5 days)\\n- Carmen Flores (8 days)\\n- Miguel Ramos (12 days)\\n- Elena V√°squez (15 days)\\n\\nClick Re-engage to launch SMS/WhatsApp/Email campaign.');
        }

        function showUncontrolledModal(condition) {
            alert(`Uncontrolled ${condition} Patients - Click to view list and export CSV`);
        }

        function showVBCModal(metric) {
            alert(`${metric} Gap Patients - Click to view list with pending activities. Export CSV available.`);
        }

        function openReengageSidebar() {
            alert('Re-engage Campaign Sidebar - Select channel:\\n- üí¨ SMS Text Message\\n- üì± WhatsApp Message\\n- üìß Email Campaign\\n\\nCustomize message and schedule send.');
        }

        function initWheel() {
            const container = canvas.parentElement;
            const size = Math.min(container.offsetWidth, 450);
            const dpr = window.devicePixelRatio || 1;
            canvas.width = size * dpr;
            canvas.height = size * dpr;
            canvas.style.width = size + 'px';
            canvas.style.height = size + 'px';
            ctx.scale(dpr, dpr);
            drawWheel(size);
            setupCanvasInteraction(size);
        }

        function drawWheel(size) {
            const cx = size / 2, cy = size / 2;
            const outerR = size * 0.46, innerR = size * 0.22;
            const anglePerSeg = (2 * Math.PI) / segments.length;
            ctx.clearRect(0, 0, size, size);

            segments.forEach((seg, i) => {
                const startA = -Math.PI / 2 + i * anglePerSeg;
                const endA = startA + anglePerSeg;
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, outerR, startA, endA);
                ctx.closePath();
                let fill = seg.color;
                if (seg.id === selectedSegment) fill = adjustBrightness(seg.color, 25);
                else if (seg.id === hoveredSegment) fill = adjustBrightness(seg.color, 12);
                ctx.fillStyle = fill;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                const midA = startA + anglePerSeg / 2;
                const labelR = (outerR + innerR) / 2;
                const lx = cx + Math.cos(midA) * labelR;
                const ly = cy + Math.sin(midA) * labelR;
                ctx.save();
                ctx.translate(lx, ly);
                let textA = midA + Math.PI / 2;
                if (Math.cos(midA) < 0) textA += Math.PI;
                ctx.rotate(textA);
                ctx.fillStyle = (seg.color === '#e6d9d3' || seg.color === '#f3bf57') ? '#2d1628' : '#fff';
                ctx.font = 'bold 9px Nunito';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                seg.label.split('\n').forEach((line, j, arr) => {
                    ctx.fillText(line, 0, (j - (arr.length - 1) / 2) * 10);
                });
                ctx.restore();
            });

            ctx.beginPath();
            ctx.arc(cx, cy, innerR, 0, 2 * Math.PI);
            ctx.fillStyle = '#e6d9d3';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.stroke();
            ctx.fillStyle = '#2d1628';
            ctx.font = 'bold 26px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('78%', cx, cy - 6);
            ctx.font = '11px Nunito';
            ctx.fillStyle = '#5a4b44';
            ctx.fillText('Overall Score', cx, cy + 14);
        }

        function adjustBrightness(hex, pct) {
            const num = parseInt(hex.replace('#', ''), 16);
            const amt = Math.round(2.55 * pct);
            const R = Math.min(255, (num >> 16) + amt);
            const G = Math.min(255, ((num >> 8) & 0xFF) + amt);
            const B = Math.min(255, (num & 0xFF) + amt);
            return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }

        function setupCanvasInteraction(size) {
            const cx = size / 2, cy = size / 2;
            const outerR = size * 0.46, innerR = size * 0.22;
            const anglePerSeg = (2 * Math.PI) / segments.length;

            canvas.addEventListener('mousemove', e => {
                const rect = canvas.getBoundingClientRect();
                const seg = getSegmentAtPoint(e.clientX - rect.left, e.clientY - rect.top, cx, cy, outerR, innerR, anglePerSeg);
                if (seg !== hoveredSegment) { hoveredSegment = seg; drawWheel(size); canvas.style.cursor = seg ? 'pointer' : 'default'; }
            });

            canvas.addEventListener('click', e => {
                const rect = canvas.getBoundingClientRect();
                const seg = getSegmentAtPoint(e.clientX - rect.left, e.clientY - rect.top, cx, cy, outerR, innerR, anglePerSeg);
                if (seg) { selectedSegment = seg; drawWheel(size); selectMetric(seg); updateCategoryCards(seg); }
            });

            canvas.addEventListener('mouseleave', () => { hoveredSegment = null; drawWheel(size); });
        }

        function getSegmentAtPoint(x, y, cx, cy, outerR, innerR, anglePerSeg) {
            const dx = x - cx, dy = y - cy, dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < innerR || dist > outerR) return null;
            let angle = Math.atan2(dy, dx) + Math.PI / 2;
            if (angle < 0) angle += 2 * Math.PI;
            return segments[Math.floor(angle / anglePerSeg) % segments.length].id;
        }

        function selectMetric(id) {
            const data = metricsData[id];
            if (!data) return;
            selectedSegment = id;
            const card = document.getElementById('metricDetail');

            document.getElementById('selectedCategory').textContent = data.category;
            document.getElementById('selectedMetric').textContent = data.name;
            document.getElementById('metricValue').textContent = data.value;
            document.getElementById('metricTarget').textContent = data.target;
            document.getElementById('statusBadge').textContent = data.status;
            document.getElementById('statusBadge').className = 'status-badge ' + data.statusClass;
            document.getElementById('progressBar').style.width = data.progress + '%';

            const btn = document.getElementById('detailBtn');
            btn.style.display = data.btnText ? 'inline-flex' : 'none';
            if (data.btnText) { btn.textContent = data.btnText; btn.onclick = () => window[data.btnAction](); }

            const examInfo = document.getElementById('examInfo');
            examInfo.style.display = data.showExam ? 'flex' : 'none';
            if (data.showExam) {
                document.querySelector('#examItem1 .exam-label').textContent = data.exam1.label;
                document.querySelector('#examItem1 .exam-date').textContent = data.exam1.date;
                document.querySelector('#examItem1 .exam-result').textContent = data.exam1.result;
                document.querySelector('#examItem2 .exam-label').textContent = data.exam2.label;
                document.querySelector('#examItem2 .exam-date').textContent = data.exam2.date;
                document.querySelector('#examItem2 .exam-result').textContent = data.exam2.result;
            }

            const proContent = document.getElementById('proContent');
            const metricContent = document.querySelector('.metric-content');
            proContent.style.display = data.showPRO ? 'block' : 'none';
            metricContent.style.display = data.showPRO ? 'none' : 'flex';
            card.classList.toggle('pro-active', data.showPRO);
        }

        function selectMetabolicPanel(el, type) {
            document.querySelectorAll('.metabolic-panel').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
        }

        function selectCategory(el, cat) {
            document.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            const map = { pro: 'wellbeing', acute: 'hypo', chronic: 'vascular', survival: 'vital', utilization: 'utilization', barriers: 'barriers' };
            if (map[cat]) selectMetric(map[cat]);
        }

        function updateCategoryCards(segId) {
            const catMap = {
                wellbeing: 'pro', distress: 'pro', depression: 'pro',
                dka: 'acute', hhs: 'acute', hypo: 'acute',
                vascular: 'chronic', neuro: 'chronic', treatment: 'chronic',
                vital: 'survival', barriers: 'barriers', utilization: 'utilization', glycemic: 'acute'
            };
            const cat = catMap[segId];
            document.querySelectorAll('.category-card').forEach(c => c.classList.toggle('active', c.dataset.category === cat));
        }

        function toggleProAccordion(el) {
            el.classList.toggle('open');
        }

        function showMetricDetails() {
            if (selectedSegment === 'hypo') openGlucoseModal();
            else if (selectedSegment === 'utilization') openUtilSidebar();
            else if (selectedSegment === 'barriers') openSDOHSidebar();
        }

        function openCareTeamModal() { document.getElementById('careTeamModal').classList.add('open'); }
        function closeCareTeamModal(e) { if (!e || e.target.id === 'careTeamModal') document.getElementById('careTeamModal').classList.remove('open'); }

        function openGlucoseModal() { document.getElementById('glucoseModal').classList.add('open'); }
        function closeGlucoseModal(e) { if (!e || e.target.id === 'glucoseModal') document.getElementById('glucoseModal').classList.remove('open'); }

        function openUtilSidebar() { document.getElementById('utilSidebarOverlay').classList.add('open'); document.getElementById('utilSidebar').classList.add('open'); }
        function closeUtilSidebar() { document.getElementById('utilSidebarOverlay').classList.remove('open'); document.getElementById('utilSidebar').classList.remove('open'); }

        function openSDOHSidebar() { document.getElementById('sdohSidebarOverlay').classList.add('open'); document.getElementById('sdohSidebar').classList.add('open'); }
        function closeSDOHSidebar() { document.getElementById('sdohSidebarOverlay').classList.remove('open'); document.getElementById('sdohSidebar').classList.remove('open'); }

        function populatePatientTable() {
            document.getElementById('patientTableBody').innerHTML = patients.map(p => `
                <tr>
                    <td class="patient-name-cell">${p.name}</td>
                    <td><div class="patient-conditions">${p.conditions.map(c => `<span class="condition-tag">${c}</span>`).join('')}</div></td>
                    <td><span class="risk-badge ${p.risk}">${p.risk.charAt(0).toUpperCase() + p.risk.slice(1)}</span></td>
                    <td>${p.a1c}%</td>
                    <td>${p.bp}</td>
                    <td><span class="trend-icon ${p.trend}">${p.trend === 'down' ? '‚Üì' : p.trend === 'up' ? '‚Üë' : '‚Üí'}</span></td>
                    <td><span class="phase-badge">${p.phase}</span></td>
                    <td>${p.lastTouch}</td>
                    <td>${p.flags.map(f => `<span class="flag-badge">${f}</span>`).join('') || '‚Äî'}</td>
                </tr>
            `).join('');
        }

        function filterPatients(filter, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('#patientTableBody tr').forEach((row, i) => {
                const p = patients[i];
                let show = filter === 'all' || (filter === 'high' && p.risk === 'high') || (filter === 'flags' && p.flags.length > 0);
                row.style.display = show ? '' : 'none';
            });
        }

        function searchPatients(q) {
            document.querySelectorAll('#patientTableBody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
            });
        }

        window.addEventListener('resize', () => { if (canvas && ctx) initWheel(); });
    </script>
</body>
</html>